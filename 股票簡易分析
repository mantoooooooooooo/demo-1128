{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "view-in-github",
        "colab_type": "text"
      },
      "source": [
        "<a href=\"https://colab.research.google.com/github/mantoooooooooooo/demo-1128/blob/main/%E8%82%A1%E7%A5%A8%E7%B0%A1%E6%98%93%E5%88%86%E6%9E%90\" target=\"_parent\"><img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a>"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "# Google Colab è‚¡ç¥¨æç›Šåˆ†æç¨‹å¼\n",
        "# è«‹åœ¨Colabä¸­åŸ·è¡Œæ­¤ç¨‹å¼\n",
        "\n",
        "# å®‰è£å¿…è¦å¥—ä»¶\n",
        "!pip install openpyxl -q\n",
        "\n",
        "import pandas as pd\n",
        "from openpyxl import Workbook\n",
        "from openpyxl.styles import Font, PatternFill, Alignment\n",
        "import io\n",
        "from google.colab import files\n",
        "from datetime import datetime\n",
        "\n",
        "def upload_and_analyze():\n",
        "    \"\"\"ä¸Šå‚³æª”æ¡ˆä¸¦åˆ†æè‚¡ç¥¨æç›Š\"\"\"\n",
        "\n",
        "    print(\"è«‹é¸æ“‡æ‚¨çš„äº¤æ˜“è¨˜éŒ„æª”æ¡ˆï¼ˆæ”¯æ´ .csv æˆ– .txt æ ¼å¼ï¼‰\")\n",
        "    print(\"=\" * 50)\n",
        "\n",
        "    # ä¸Šå‚³æª”æ¡ˆ\n",
        "    uploaded = files.upload()\n",
        "\n",
        "    if not uploaded:\n",
        "        print(\"æ²’æœ‰ä¸Šå‚³ä»»ä½•æª”æ¡ˆï¼\")\n",
        "        return\n",
        "\n",
        "    # ç²å–ä¸Šå‚³çš„æª”æ¡ˆ\n",
        "    filename = list(uploaded.keys())[0]\n",
        "    print(f\"\\næˆåŠŸä¸Šå‚³æª”æ¡ˆ: {filename}\")\n",
        "\n",
        "    try:\n",
        "        # è®€å–æª”æ¡ˆå…§å®¹\n",
        "        file_content = uploaded[filename]\n",
        "\n",
        "        # å˜—è©¦ä¸åŒçš„ç·¨ç¢¼æ–¹å¼è®€å–\n",
        "        try:\n",
        "            # å…ˆå˜—è©¦ UTF-8\n",
        "            content_str = file_content.decode('utf-8')\n",
        "            print(\"ä½¿ç”¨ UTF-8 ç·¨ç¢¼è®€å–\")\n",
        "        except UnicodeDecodeError:\n",
        "            try:\n",
        "                # å†å˜—è©¦ Big5\n",
        "                content_str = file_content.decode('big5')\n",
        "                print(\"ä½¿ç”¨ Big5 ç·¨ç¢¼è®€å–\")\n",
        "            except UnicodeDecodeError:\n",
        "                # æœ€å¾Œå˜—è©¦ GBK\n",
        "                content_str = file_content.decode('gbk')\n",
        "                print(\"ä½¿ç”¨ GBK ç·¨ç¢¼è®€å–\")\n",
        "\n",
        "        # å°‡å…§å®¹è½‰æ›ç‚ºDataFrame\n",
        "        df = pd.read_csv(io.StringIO(content_str))\n",
        "        print(f\"æˆåŠŸè®€å– {len(df)} ç­†äº¤æ˜“è¨˜éŒ„\")\n",
        "\n",
        "        # é¡¯ç¤ºæª”æ¡ˆåŸºæœ¬è³‡è¨Š\n",
        "        print(f\"\\næª”æ¡ˆè³‡è¨Š:\")\n",
        "        print(f\"- è³‡æ–™ç­†æ•¸: {len(df)}\")\n",
        "        print(f\"- æ¬„ä½æ•¸é‡: {len(df.columns)}\")\n",
        "        print(f\"- æ¬„ä½åç¨±: {list(df.columns)}\")\n",
        "\n",
        "        # é¡¯ç¤ºå‰å¹¾ç­†è³‡æ–™é è¦½\n",
        "        print(f\"\\nå‰5ç­†è³‡æ–™é è¦½:\")\n",
        "        print(df.head())\n",
        "\n",
        "        return analyze_stock_data(df, filename)\n",
        "\n",
        "    except Exception as e:\n",
        "        print(f\"è®€å–æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}\")\n",
        "        print(\"\\nå¯èƒ½çš„è§£æ±ºæ–¹æ¡ˆ:\")\n",
        "        print(\"1. ç¢ºèªæª”æ¡ˆæ ¼å¼æ˜¯CSV\")\n",
        "        print(\"2. æª¢æŸ¥æª”æ¡ˆç·¨ç¢¼æ˜¯å¦æ­£ç¢º\")\n",
        "        print(\"3. ç¢ºèªæª”æ¡ˆå…§å®¹æ ¼å¼æ­£ç¢º\")\n",
        "        return None\n",
        "\n",
        "def analyze_stock_data(df, filename):\n",
        "    \"\"\"åˆ†æè‚¡ç¥¨äº¤æ˜“æ•¸æ“š\"\"\"\n",
        "\n",
        "    try:\n",
        "        # æª¢æŸ¥å¿…è¦æ¬„ä½æ˜¯å¦å­˜åœ¨\n",
        "        required_columns = [\"ä»£è™Ÿ\", \"è‚¡ç¥¨åç¨±\", \"è²·è³£åˆ¥\", \"åŸå¹£æ‡‰æ”¶ä»˜é‡‘é¡\"]\n",
        "        missing_columns = []\n",
        "\n",
        "        # æª¢æŸ¥æ¬„ä½ï¼ˆå…è¨±éƒ¨åˆ†æ¨¡ç³ŠåŒ¹é…ï¼‰\n",
        "        column_mapping = {}\n",
        "        for required_col in required_columns:\n",
        "            found = False\n",
        "            for actual_col in df.columns:\n",
        "                if required_col in actual_col or actual_col in required_col:\n",
        "                    column_mapping[required_col] = actual_col\n",
        "                    found = True\n",
        "                    break\n",
        "            if not found:\n",
        "                missing_columns.append(required_col)\n",
        "\n",
        "        if missing_columns:\n",
        "            print(f\"âŒ ç¼ºå°‘å¿…è¦æ¬„ä½: {missing_columns}\")\n",
        "            print(f\"ç¾æœ‰æ¬„ä½: {list(df.columns)}\")\n",
        "            print(\"\\nè«‹ç¢ºèªæ‚¨çš„CSVæª”æ¡ˆåŒ…å«ä»¥ä¸‹æ¬„ä½ï¼š\")\n",
        "            for col in required_columns:\n",
        "                print(f\"- {col}\")\n",
        "            return None\n",
        "\n",
        "        # ä½¿ç”¨æ˜ å°„å¾Œçš„æ¬„ä½åç¨±\n",
        "        for required_col, actual_col in column_mapping.items():\n",
        "            if required_col != actual_col:\n",
        "                df = df.rename(columns={actual_col: required_col})\n",
        "                print(f\"æ¬„ä½æ˜ å°„: '{actual_col}' â†’ '{required_col}'\")\n",
        "\n",
        "        print(\"\\nâœ… é–‹å§‹é€²è¡Œæç›Šåˆ†æ...\")\n",
        "\n",
        "        # æ•¸æ“šæ¸…ç†ï¼šè™•ç†é‡‘é¡æ¬„ä½\n",
        "        amount_columns = [\"åŸå¹£æ‡‰æ”¶ä»˜é‡‘é¡\", \"æˆäº¤é‡‘é¡\"]\n",
        "\n",
        "        for col in amount_columns:\n",
        "            if col in df.columns:\n",
        "                # ç§»é™¤é€—è™Ÿä¸¦è½‰æ›ç‚ºæ•¸å€¼\n",
        "                df[col] = df[col].astype(str).str.replace(',', '').str.replace('$', '')\n",
        "                df[col] = pd.to_numeric(df[col], errors='coerce')\n",
        "                print(f\"âœ… å·²æ¸…ç†æ¬„ä½: {col}\")\n",
        "\n",
        "        # è¨ˆç®—å–®æª”è‚¡ç¥¨æç›Š\n",
        "        print(\"ğŸ“Š æ­£åœ¨è¨ˆç®—å€‹è‚¡æç›Š...\")\n",
        "\n",
        "        realized_pnl = df.groupby([\"ä»£è™Ÿ\", \"è‚¡ç¥¨åç¨±\", \"è²·è³£åˆ¥\"])[\"åŸå¹£æ‡‰æ”¶ä»˜é‡‘é¡\"].sum().unstack(fill_value=0)\n",
        "\n",
        "        # ç¢ºä¿æ¬„ä½å­˜åœ¨\n",
        "        for col in [\"è²·é€²\", \"è³£å‡º\"]:\n",
        "            if col not in realized_pnl.columns:\n",
        "                realized_pnl[col] = 0\n",
        "\n",
        "        # è¨ˆç®—å·²å¯¦ç¾æç›Š\n",
        "        realized_pnl[\"å·²å¯¦ç¾æç›Š\"] = realized_pnl[\"è³£å‡º\"] + realized_pnl[\"è²·é€²\"]\n",
        "\n",
        "        # è¨ˆç®—æŠ•è³‡æˆæœ¬ï¼ˆè²·é€²çš„çµ•å°å€¼ï¼‰\n",
        "        realized_pnl[\"æŠ•è³‡æˆæœ¬\"] = abs(realized_pnl[\"è²·é€²\"])\n",
        "\n",
        "        # è¨ˆç®—å ±é…¬ç‡\n",
        "        realized_pnl[\"å ±é…¬ç‡(%)\"] = (realized_pnl[\"å·²å¯¦ç¾æç›Š\"] / realized_pnl[\"æŠ•è³‡æˆæœ¬\"] * 100).round(2)\n",
        "        realized_pnl[\"å ±é…¬ç‡(%)\"] = realized_pnl[\"å ±é…¬ç‡(%)\"].replace([float('inf'), -float('inf')], 0)\n",
        "\n",
        "        realized_pnl = realized_pnl.reset_index()\n",
        "\n",
        "        # ä¾å·²å¯¦ç¾æç›Šæ’åº\n",
        "        realized_pnl = realized_pnl.sort_values(by=\"å·²å¯¦ç¾æç›Š\", ascending=False).reset_index(drop=True)\n",
        "        realized_pnl.insert(0, \"æ’å\", realized_pnl.index + 1)\n",
        "\n",
        "        # çµ±è¨ˆåˆ†æ\n",
        "        winning_stocks = len(realized_pnl[realized_pnl[\"å·²å¯¦ç¾æç›Š\"] > 0])\n",
        "        total_stocks = len(realized_pnl)\n",
        "        win_rate = (winning_stocks / total_stocks * 100) if total_stocks > 0 else 0\n",
        "\n",
        "        # æ•´é«”çµ„åˆç¸½çµ\n",
        "        total_summary = {\n",
        "            \"ç¸½æŠ•è³‡æˆæœ¬\": abs(realized_pnl[\"è²·é€²\"].sum()),\n",
        "            \"ç¸½è³£å‡ºé‡‘é¡\": realized_pnl[\"è³£å‡º\"].sum(),\n",
        "            \"ç¸½å·²å¯¦ç¾æç›Š\": realized_pnl[\"å·²å¯¦ç¾æç›Š\"].sum(),\n",
        "            \"æ•´é«”å ±é…¬ç‡(%)\": (realized_pnl[\"å·²å¯¦ç¾æç›Š\"].sum() / abs(realized_pnl[\"è²·é€²\"].sum()) * 100).round(2) if realized_pnl[\"è²·é€²\"].sum() != 0 else 0,\n",
        "            \"äº¤æ˜“è‚¡ç¥¨æ•¸é‡\": total_stocks,\n",
        "            \"ç²åˆ©è‚¡ç¥¨æ•¸é‡\": winning_stocks,\n",
        "            \"è™§æè‚¡ç¥¨æ•¸é‡\": total_stocks - winning_stocks,\n",
        "            \"å‹ç‡(%)\": round(win_rate, 2)\n",
        "        }\n",
        "\n",
        "        # é¡¯ç¤ºåˆ†æçµæœ\n",
        "        print(\"\\n\" + \"=\"*60)\n",
        "        print(\"ğŸ“ˆ æŠ•è³‡çµ„åˆåˆ†æçµæœ\")\n",
        "        print(\"=\"*60)\n",
        "\n",
        "        for key, value in total_summary.items():\n",
        "            if isinstance(value, (int, float)):\n",
        "                if \"%\" in key:\n",
        "                    print(f\"{key:15s}: {value:8.2f}%\")\n",
        "                elif \"æ•¸é‡\" in key:\n",
        "                    print(f\"{key:15s}: {value:8d}\")\n",
        "                else:\n",
        "                    print(f\"{key:15s}: ${value:12,.2f}\")\n",
        "\n",
        "        print(\"\\nğŸ† è¡¨ç¾æœ€ä½³å‰5æª”è‚¡ç¥¨:\")\n",
        "        print(\"-\" * 80)\n",
        "        print(f\"{'æ’å':<4} {'ä»£è™Ÿ':<8} {'è‚¡ç¥¨åç¨±':<12} {'å·²å¯¦ç¾æç›Š':<12} {'å ±é…¬ç‡':<8}\")\n",
        "        print(\"-\" * 80)\n",
        "\n",
        "        for _, row in realized_pnl.head().iterrows():\n",
        "            pnl_str = f\"${row['å·²å¯¦ç¾æç›Š']:,.0f}\"\n",
        "            return_str = f\"{row['å ±é…¬ç‡(%)']:.1f}%\"\n",
        "            print(f\"{row['æ’å']:<4} {row['ä»£è™Ÿ']:<8} {row['è‚¡ç¥¨åç¨±']:<12} {pnl_str:<12} {return_str:<8}\")\n",
        "\n",
        "        # å»ºç«‹Excelå ±è¡¨\n",
        "        create_excel_report(realized_pnl, total_summary, df, filename)\n",
        "\n",
        "        return realized_pnl, total_summary\n",
        "\n",
        "    except Exception as e:\n",
        "        print(f\"âŒ åˆ†æéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤: {str(e)}\")\n",
        "        print(\"è«‹æª¢æŸ¥è³‡æ–™æ ¼å¼æ˜¯å¦æ­£ç¢º\")\n",
        "        return None\n",
        "\n",
        "def create_excel_report(realized_pnl, total_summary, original_df, filename):\n",
        "    \"\"\"å»ºç«‹ä¸¦ä¸‹è¼‰Excelå ±è¡¨\"\"\"\n",
        "\n",
        "    print(\"\\nğŸ“„ æ­£åœ¨ç”ŸæˆExcelå ±è¡¨...\")\n",
        "\n",
        "    try:\n",
        "        wb = Workbook()\n",
        "\n",
        "        # è¨­å®šæ¨£å¼\n",
        "        header_font = Font(bold=True, color=\"FFFFFF\")\n",
        "        header_fill = PatternFill(\"solid\", fgColor=\"366092\")\n",
        "        header_alignment = Alignment(horizontal=\"center\")\n",
        "\n",
        "        # å·¥ä½œè¡¨ 1: å–®æª”è‚¡ç¥¨æç›Š\n",
        "        ws1 = wb.active\n",
        "        ws1.title = \"å–®æª”è‚¡ç¥¨æç›Š\"\n",
        "\n",
        "        headers = [\"æ’å\", \"è‚¡ç¥¨ä»£è™Ÿ\", \"è‚¡ç¥¨åç¨±\", \"æŠ•è³‡æˆæœ¬(USD)\", \"è³£å‡ºé‡‘é¡(USD)\", \"å·²å¯¦ç¾æç›Š(USD)\", \"å ±é…¬ç‡(%)\"]\n",
        "        ws1.append(headers)\n",
        "\n",
        "        # å¥—ç”¨æ¨™é¡Œæ¨£å¼\n",
        "        for col_num, header in enumerate(headers, 1):\n",
        "            cell = ws1.cell(row=1, column=col_num)\n",
        "            cell.font = header_font\n",
        "            cell.fill = header_fill\n",
        "            cell.alignment = header_alignment\n",
        "\n",
        "        # åŠ å…¥æ•¸æ“šä¸¦è¨­å®šæ ¼å¼\n",
        "        for _, row in realized_pnl.iterrows():\n",
        "            ws1.append([\n",
        "                row[\"æ’å\"],\n",
        "                row[\"ä»£è™Ÿ\"],\n",
        "                row[\"è‚¡ç¥¨åç¨±\"],\n",
        "                abs(row[\"è²·é€²\"]),\n",
        "                row[\"è³£å‡º\"],\n",
        "                row[\"å·²å¯¦ç¾æç›Š\"],\n",
        "                row[\"å ±é…¬ç‡(%)\"]\n",
        "            ])\n",
        "\n",
        "        # è¨­å®šæç›Šé¡è‰²\n",
        "        for row_num in range(2, len(realized_pnl) + 2):\n",
        "            pnl_cell = ws1.cell(row=row_num, column=6)\n",
        "            return_cell = ws1.cell(row=row_num, column=7)\n",
        "\n",
        "            if pnl_cell.value > 0:\n",
        "                pnl_cell.font = Font(color=\"00AA00\")\n",
        "                return_cell.font = Font(color=\"00AA00\")\n",
        "            elif pnl_cell.value < 0:\n",
        "                pnl_cell.font = Font(color=\"FF0000\")\n",
        "                return_cell.font = Font(color=\"FF0000\")\n",
        "\n",
        "        # èª¿æ•´æ¬„å¯¬\n",
        "        column_widths = [8, 12, 20, 15, 15, 15, 12]\n",
        "        for i, width in enumerate(column_widths, 1):\n",
        "            ws1.column_dimensions[ws1.cell(row=1, column=i).column_letter].width = width\n",
        "\n",
        "        # å·¥ä½œè¡¨ 2: æ•´é«”æç›Šç¸½çµ\n",
        "        ws2 = wb.create_sheet(\"æ•´é«”æç›Šç¸½çµ\")\n",
        "        ws2.append([\"é …ç›®\", \"æ•¸å€¼\"])\n",
        "\n",
        "        # å¥—ç”¨æ¨™é¡Œæ¨£å¼\n",
        "        for col_num in range(1, 3):\n",
        "            cell = ws2.cell(row=1, column=col_num)\n",
        "            cell.font = header_font\n",
        "            cell.fill = header_fill\n",
        "            cell.alignment = header_alignment\n",
        "\n",
        "        for k, v in total_summary.items():\n",
        "            ws2.append([k, v])\n",
        "\n",
        "        ws2.column_dimensions['A'].width = 20\n",
        "        ws2.column_dimensions['B'].width = 15\n",
        "\n",
        "        # å„²å­˜åˆ°è¨˜æ†¶é«”\n",
        "        output = io.BytesIO()\n",
        "        wb.save(output)\n",
        "        output.seek(0)\n",
        "\n",
        "        # ç”¢ç”Ÿæª”æ¡ˆåç¨±\n",
        "        timestamp = datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n",
        "        output_filename = f\"è‚¡ç¥¨æç›Šå ±è¡¨_{timestamp}.xlsx\"\n",
        "\n",
        "        # ä¸‹è¼‰æª”æ¡ˆ\n",
        "        files.download(output_filename)\n",
        "\n",
        "        # å°‡å…§å®¹å¯«å…¥æª”æ¡ˆä¾›ä¸‹è¼‰\n",
        "        with open(output_filename, 'wb') as f:\n",
        "            f.write(output.getvalue())\n",
        "\n",
        "        print(f\"âœ… Excelå ±è¡¨å·²ç”Ÿæˆ: {output_filename}\")\n",
        "        print(\"ğŸ“¥ æª”æ¡ˆå·²è‡ªå‹•ä¸‹è¼‰åˆ°æ‚¨çš„é›»è…¦\")\n",
        "\n",
        "    except Exception as e:\n",
        "        print(f\"âŒ ç”ŸæˆExcelå ±è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}\")\n",
        "\n",
        "# ä¸»ç¨‹å¼\n",
        "def main():\n",
        "    \"\"\"ä¸»ç¨‹å¼å…¥å£\"\"\"\n",
        "    print(\"ğŸš€ æ­¡è¿ä½¿ç”¨è‚¡ç¥¨æç›Šåˆ†æå·¥å…· (Google Colabç‰ˆ)\")\n",
        "    print(\"=\"*60)\n",
        "    print(\"ğŸ“‹ ä½¿ç”¨èªªæ˜:\")\n",
        "    print(\"1. åŸ·è¡Œæ­¤ç¨‹å¼å¾Œæœƒå‡ºç¾æª”æ¡ˆä¸Šå‚³å°è©±æ¡†\")\n",
        "    print(\"2. é¸æ“‡æ‚¨çš„äº¤æ˜“è¨˜éŒ„æª”æ¡ˆï¼ˆ.csv æˆ– .txtï¼‰\")\n",
        "    print(\"3. ç­‰å¾…ç¨‹å¼åˆ†æå®Œæˆ\")\n",
        "    print(\"4. ä¸‹è¼‰ç”Ÿæˆçš„Excelå ±è¡¨\")\n",
        "    print(\"=\"*60)\n",
        "    print()\n",
        "\n",
        "    try:\n",
        "        result = upload_and_analyze()\n",
        "        if result:\n",
        "            print(\"\\nâœ… åˆ†æå®Œæˆï¼è«‹æŸ¥çœ‹ä¸Šæ–¹çš„çµæœå’Œä¸‹è¼‰çš„Excelå ±è¡¨ã€‚\")\n",
        "        else:\n",
        "            print(\"\\nâŒ åˆ†æå¤±æ•—ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ ¼å¼å’Œå…§å®¹ã€‚\")\n",
        "    except Exception as e:\n",
        "        print(f\"\\nâŒ ç¨‹å¼åŸ·è¡Œå¤±æ•—: {str(e)}\")\n",
        "\n",
        "# åŸ·è¡Œä¸»ç¨‹å¼\n",
        "if __name__ == \"__main__\":\n",
        "    main()"
      ],
      "metadata": {
        "id": "e_OmwKCds6Ui",
        "outputId": "b579e6ff-3600-44f2-f89f-0a84f20c5cbe",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 1000
        }
      },
      "execution_count": 18,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "ğŸš€ æ­¡è¿ä½¿ç”¨è‚¡ç¥¨æç›Šåˆ†æå·¥å…· (Google Colabç‰ˆ)\n",
            "============================================================\n",
            "ğŸ“‹ ä½¿ç”¨èªªæ˜:\n",
            "1. åŸ·è¡Œæ­¤ç¨‹å¼å¾Œæœƒå‡ºç¾æª”æ¡ˆä¸Šå‚³å°è©±æ¡†\n",
            "2. é¸æ“‡æ‚¨çš„äº¤æ˜“è¨˜éŒ„æª”æ¡ˆï¼ˆ.csv æˆ– .txtï¼‰\n",
            "3. ç­‰å¾…ç¨‹å¼åˆ†æå®Œæˆ\n",
            "4. ä¸‹è¼‰ç”Ÿæˆçš„Excelå ±è¡¨\n",
            "============================================================\n",
            "\n",
            "è«‹é¸æ“‡æ‚¨çš„äº¤æ˜“è¨˜éŒ„æª”æ¡ˆï¼ˆæ”¯æ´ .csv æˆ– .txt æ ¼å¼ï¼‰\n",
            "==================================================\n"
          ]
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<IPython.core.display.HTML object>"
            ],
            "text/html": [
              "\n",
              "     <input type=\"file\" id=\"files-ffb82020-2561-4341-b50e-6f600295ad5f\" name=\"files[]\" multiple disabled\n",
              "        style=\"border:none\" />\n",
              "     <output id=\"result-ffb82020-2561-4341-b50e-6f600295ad5f\">\n",
              "      Upload widget is only available when the cell has been executed in the\n",
              "      current browser session. Please rerun this cell to enable.\n",
              "      </output>\n",
              "      <script>// Copyright 2017 Google LLC\n",
              "//\n",
              "// Licensed under the Apache License, Version 2.0 (the \"License\");\n",
              "// you may not use this file except in compliance with the License.\n",
              "// You may obtain a copy of the License at\n",
              "//\n",
              "//      http://www.apache.org/licenses/LICENSE-2.0\n",
              "//\n",
              "// Unless required by applicable law or agreed to in writing, software\n",
              "// distributed under the License is distributed on an \"AS IS\" BASIS,\n",
              "// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n",
              "// See the License for the specific language governing permissions and\n",
              "// limitations under the License.\n",
              "\n",
              "/**\n",
              " * @fileoverview Helpers for google.colab Python module.\n",
              " */\n",
              "(function(scope) {\n",
              "function span(text, styleAttributes = {}) {\n",
              "  const element = document.createElement('span');\n",
              "  element.textContent = text;\n",
              "  for (const key of Object.keys(styleAttributes)) {\n",
              "    element.style[key] = styleAttributes[key];\n",
              "  }\n",
              "  return element;\n",
              "}\n",
              "\n",
              "// Max number of bytes which will be uploaded at a time.\n",
              "const MAX_PAYLOAD_SIZE = 100 * 1024;\n",
              "\n",
              "function _uploadFiles(inputId, outputId) {\n",
              "  const steps = uploadFilesStep(inputId, outputId);\n",
              "  const outputElement = document.getElementById(outputId);\n",
              "  // Cache steps on the outputElement to make it available for the next call\n",
              "  // to uploadFilesContinue from Python.\n",
              "  outputElement.steps = steps;\n",
              "\n",
              "  return _uploadFilesContinue(outputId);\n",
              "}\n",
              "\n",
              "// This is roughly an async generator (not supported in the browser yet),\n",
              "// where there are multiple asynchronous steps and the Python side is going\n",
              "// to poll for completion of each step.\n",
              "// This uses a Promise to block the python side on completion of each step,\n",
              "// then passes the result of the previous step as the input to the next step.\n",
              "function _uploadFilesContinue(outputId) {\n",
              "  const outputElement = document.getElementById(outputId);\n",
              "  const steps = outputElement.steps;\n",
              "\n",
              "  const next = steps.next(outputElement.lastPromiseValue);\n",
              "  return Promise.resolve(next.value.promise).then((value) => {\n",
              "    // Cache the last promise value to make it available to the next\n",
              "    // step of the generator.\n",
              "    outputElement.lastPromiseValue = value;\n",
              "    return next.value.response;\n",
              "  });\n",
              "}\n",
              "\n",
              "/**\n",
              " * Generator function which is called between each async step of the upload\n",
              " * process.\n",
              " * @param {string} inputId Element ID of the input file picker element.\n",
              " * @param {string} outputId Element ID of the output display.\n",
              " * @return {!Iterable<!Object>} Iterable of next steps.\n",
              " */\n",
              "function* uploadFilesStep(inputId, outputId) {\n",
              "  const inputElement = document.getElementById(inputId);\n",
              "  inputElement.disabled = false;\n",
              "\n",
              "  const outputElement = document.getElementById(outputId);\n",
              "  outputElement.innerHTML = '';\n",
              "\n",
              "  const pickedPromise = new Promise((resolve) => {\n",
              "    inputElement.addEventListener('change', (e) => {\n",
              "      resolve(e.target.files);\n",
              "    });\n",
              "  });\n",
              "\n",
              "  const cancel = document.createElement('button');\n",
              "  inputElement.parentElement.appendChild(cancel);\n",
              "  cancel.textContent = 'Cancel upload';\n",
              "  const cancelPromise = new Promise((resolve) => {\n",
              "    cancel.onclick = () => {\n",
              "      resolve(null);\n",
              "    };\n",
              "  });\n",
              "\n",
              "  // Wait for the user to pick the files.\n",
              "  const files = yield {\n",
              "    promise: Promise.race([pickedPromise, cancelPromise]),\n",
              "    response: {\n",
              "      action: 'starting',\n",
              "    }\n",
              "  };\n",
              "\n",
              "  cancel.remove();\n",
              "\n",
              "  // Disable the input element since further picks are not allowed.\n",
              "  inputElement.disabled = true;\n",
              "\n",
              "  if (!files) {\n",
              "    return {\n",
              "      response: {\n",
              "        action: 'complete',\n",
              "      }\n",
              "    };\n",
              "  }\n",
              "\n",
              "  for (const file of files) {\n",
              "    const li = document.createElement('li');\n",
              "    li.append(span(file.name, {fontWeight: 'bold'}));\n",
              "    li.append(span(\n",
              "        `(${file.type || 'n/a'}) - ${file.size} bytes, ` +\n",
              "        `last modified: ${\n",
              "            file.lastModifiedDate ? file.lastModifiedDate.toLocaleDateString() :\n",
              "                                    'n/a'} - `));\n",
              "    const percent = span('0% done');\n",
              "    li.appendChild(percent);\n",
              "\n",
              "    outputElement.appendChild(li);\n",
              "\n",
              "    const fileDataPromise = new Promise((resolve) => {\n",
              "      const reader = new FileReader();\n",
              "      reader.onload = (e) => {\n",
              "        resolve(e.target.result);\n",
              "      };\n",
              "      reader.readAsArrayBuffer(file);\n",
              "    });\n",
              "    // Wait for the data to be ready.\n",
              "    let fileData = yield {\n",
              "      promise: fileDataPromise,\n",
              "      response: {\n",
              "        action: 'continue',\n",
              "      }\n",
              "    };\n",
              "\n",
              "    // Use a chunked sending to avoid message size limits. See b/62115660.\n",
              "    let position = 0;\n",
              "    do {\n",
              "      const length = Math.min(fileData.byteLength - position, MAX_PAYLOAD_SIZE);\n",
              "      const chunk = new Uint8Array(fileData, position, length);\n",
              "      position += length;\n",
              "\n",
              "      const base64 = btoa(String.fromCharCode.apply(null, chunk));\n",
              "      yield {\n",
              "        response: {\n",
              "          action: 'append',\n",
              "          file: file.name,\n",
              "          data: base64,\n",
              "        },\n",
              "      };\n",
              "\n",
              "      let percentDone = fileData.byteLength === 0 ?\n",
              "          100 :\n",
              "          Math.round((position / fileData.byteLength) * 100);\n",
              "      percent.textContent = `${percentDone}% done`;\n",
              "\n",
              "    } while (position < fileData.byteLength);\n",
              "  }\n",
              "\n",
              "  // All done.\n",
              "  yield {\n",
              "    response: {\n",
              "      action: 'complete',\n",
              "    }\n",
              "  };\n",
              "}\n",
              "\n",
              "scope.google = scope.google || {};\n",
              "scope.google.colab = scope.google.colab || {};\n",
              "scope.google.colab._files = {\n",
              "  _uploadFiles,\n",
              "  _uploadFilesContinue,\n",
              "};\n",
              "})(self);\n",
              "</script> "
            ]
          },
          "metadata": {}
        },
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Saving 20250920174741.csv to 20250920174741.csv\n",
            "\n",
            "æˆåŠŸä¸Šå‚³æª”æ¡ˆ: 20250920174741.csv\n",
            "ä½¿ç”¨ UTF-8 ç·¨ç¢¼è®€å–\n",
            "æˆåŠŸè®€å– 155 ç­†äº¤æ˜“è¨˜éŒ„\n",
            "\n",
            "æª”æ¡ˆè³‡è¨Š:\n",
            "- è³‡æ–™ç­†æ•¸: 155\n",
            "- æ¬„ä½æ•¸é‡: 14\n",
            "- æ¬„ä½åç¨±: ['ä»£è™Ÿ', 'è‚¡ç¥¨åç¨±', 'äº¤æ˜“æ—¥æœŸ', 'è²·è³£åˆ¥', 'è‚¡æ•¸', 'äº¤å‰²æ—¥æœŸ', 'å¸‚å ´', 'å¹£åˆ¥', 'æˆäº¤åƒ¹', 'æˆäº¤é‡‘é¡', 'æ‰‹çºŒè²»', 'å…¶ä»–è²»ç”¨', 'åŸå¹£æ‡‰æ”¶ä»˜é‡‘é¡', 'å°å¹£æ‡‰æ”¶ä»˜é‡‘é¡']\n",
            "\n",
            "å‰5ç­†è³‡æ–™é è¦½:\n",
            "     ä»£è™Ÿ                               è‚¡ç¥¨åç¨±        äº¤æ˜“æ—¥æœŸ è²·è³£åˆ¥   è‚¡æ•¸        äº¤å‰²æ—¥æœŸ  \\\n",
            "0  OPEN          OPENDOOR TECHNOLOGIES INC  2025/08/29  è²·é€²  300  2025/09/02   \n",
            "1  PLTR          Palantir Technologies Inc  2025/08/29  è³£å‡º    5  2025/09/03   \n",
            "2  SOFI              SoFi Technologies Inc  2025/08/29  è²·é€²    5  2025/09/02   \n",
            "3  WOOF  Petco Health and Wellness Company  2025/08/29  è²·é€²  100  2025/09/02   \n",
            "4  WOOF  Petco Health and Wellness Company  2025/08/29  è³£å‡º  100  2025/09/03   \n",
            "\n",
            "   å¸‚å ´   å¹£åˆ¥       æˆäº¤åƒ¹      æˆäº¤é‡‘é¡   æ‰‹çºŒè²»  å…¶ä»–è²»ç”¨    åŸå¹£æ‡‰æ”¶ä»˜é‡‘é¡  å°å¹£æ‡‰æ”¶ä»˜é‡‘é¡  \n",
            "0  ç¾åœ‹  USD    4.7899  1,436.97  1.44     0  -1,438.41  -44,094  \n",
            "1  ç¾åœ‹  USD  156.7000     783.5  0.78     0     782.72   23,994  \n",
            "2  ç¾åœ‹  USD   25.4700    127.35  0.13     0    -127.48   -3,908  \n",
            "3  ç¾åœ‹  USD    3.9197    391.97  0.39     0    -392.36  -12,028  \n",
            "4  ç¾åœ‹  USD    4.0000       400  0.40     0      399.6   12,250  \n",
            "\n",
            "âœ… é–‹å§‹é€²è¡Œæç›Šåˆ†æ...\n",
            "âœ… å·²æ¸…ç†æ¬„ä½: åŸå¹£æ‡‰æ”¶ä»˜é‡‘é¡\n",
            "âœ… å·²æ¸…ç†æ¬„ä½: æˆäº¤é‡‘é¡\n",
            "ğŸ“Š æ­£åœ¨è¨ˆç®—å€‹è‚¡æç›Š...\n",
            "\n",
            "============================================================\n",
            "ğŸ“ˆ æŠ•è³‡çµ„åˆåˆ†æçµæœ\n",
            "============================================================\n",
            "ç¸½æŠ•è³‡æˆæœ¬          : $   26,538.92\n",
            "ç¸½è³£å‡ºé‡‘é¡          : $   24,367.54\n",
            "ç¸½å·²å¯¦ç¾æç›Š         : $   -2,171.38\n",
            "æ•´é«”å ±é…¬ç‡(%)       :    -8.18%\n",
            "äº¤æ˜“è‚¡ç¥¨æ•¸é‡         :       24\n",
            "ç²åˆ©è‚¡ç¥¨æ•¸é‡         :       15\n",
            "è™§æè‚¡ç¥¨æ•¸é‡         :        9\n",
            "å‹ç‡(%)          :    62.50%\n",
            "\n",
            "ğŸ† è¡¨ç¾æœ€ä½³å‰5æª”è‚¡ç¥¨:\n",
            "--------------------------------------------------------------------------------\n",
            "æ’å   ä»£è™Ÿ       è‚¡ç¥¨åç¨±         å·²å¯¦ç¾æç›Š        å ±é…¬ç‡     \n",
            "--------------------------------------------------------------------------------\n",
            "1    TSLA     ç‰¹æ–¯æ‹‰          $2,959       171.5%  \n",
            "2    IONQ     IonQ         $943         155.8%  \n",
            "3    AMD      è¶…å¾®åŠå°é«”        $408         40.4%   \n",
            "4    PLTR     Palantir Technologies Inc $35          2.1%    \n",
            "5    APLD     Applied Digital Corp $22          5.1%    \n",
            "\n",
            "ğŸ“„ æ­£åœ¨ç”ŸæˆExcelå ±è¡¨...\n",
            "âŒ ç”ŸæˆExcelå ±è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤: Cannot find file: è‚¡ç¥¨æç›Šå ±è¡¨_20250921_145134.xlsx\n",
            "\n",
            "âœ… åˆ†æå®Œæˆï¼è«‹æŸ¥çœ‹ä¸Šæ–¹çš„çµæœå’Œä¸‹è¼‰çš„Excelå ±è¡¨ã€‚\n"
          ]
        }
      ]
    }
  ],
  "metadata": {
    "colab": {
      "name": "æ­¡è¿ä½¿ç”¨ Colab",
      "provenance": [],
      "include_colab_link": true
    },
    "kernelspec": {
      "display_name": "Python 3",
      "name": "python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}